function ownKeys(c,d){var a=Object.keys(c);if(Object.getOwnPropertySymbols){var b=Object.getOwnPropertySymbols(c);d&&(b=b.filter(function(a){return Object.getOwnPropertyDescriptor(c,a).enumerable})),a.push.apply(a,b)}return a}function _objectSpread(c){for(var a=1;a<arguments.length;a++){var b=null!=arguments[a]?arguments[a]:{};a%2?ownKeys(Object(b),!0).forEach(function(a){_defineProperty(c,a,b[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(c,Object.getOwnPropertyDescriptors(b)):ownKeys(Object(b)).forEach(function(a){Object.defineProperty(c,a,Object.getOwnPropertyDescriptor(b,a))})}return c}function _defineProperty(a,b,c){return b in a?Object.defineProperty(a,b,{value:c,enumerable:!0,configurable:!0,writable:!0}):a[b]=c,a}function _defineProperties(d,c){for(var b=0;b<c.length;b++){var a=c[b];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(d,a.key,a)}}function _createClass(a,b,c){return b&&_defineProperties(a.prototype,b),c&&_defineProperties(a,c),Object.defineProperty(a,"prototype",{writable:!1}),a}function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}var API_URL="https://62dc2d424438813a2612aa65.mockapi.io/api/todos",Todo=function(){"use strict";function a(b){var c=b.id,d=b.name,e=b.creationDate,f=b.node,g=b.notes;_classCallCheck(this,a),this.id=c,this.name=d,this.creationDate=e,this.node=f,this.notes=g}return _createClass(a)}(),TodoInputController=function(){"use strict";function a(b,c){var d=b.todoController,e=b.todoApiService,f=b.todoHandler;_classCallCheck(this,a),this._todoController=d,this._todoApiService=e,this._todoHandler=f,this._setListeners(c)}return _createClass(a,[{key:"_setListeners",value:function(a){var b=this;a.addEventListener("submit",function(c){c.preventDefault(),c.stopPropagation();var d=new FormData(c.target).get("add-todo-input");if(!d)return null;var e={name:d,creationDate:new Date,status:!1};b._todoApiService.create(e).then(function(c){var d=b._todoController.create(_objectSpread(_objectSpread({},c),{},{notes:""}));b._todoHandler.addListeners(d),a.reset()})})}}]),a}(),EditFormController=function(){"use strict";function a(b,c,d){var e=b.apiService,f=b.todosController;_classCallCheck(this,a),this._apiService=e,this._todosController=f,this._modal=new bootstrap.Modal(document.getElementById(d)),this._formNode=c,this._todo=null,this._addListeners(c)}return _createClass(a,[{key:"_addListeners",value:function(a){var b=this;a.addEventListener("submit",function(a){a.preventDefault(),a.stopPropagation();var c=new FormData(a.target),d=c.get("titleInput"),e=c.get("notesInput");b._apiService.update(_objectSpread(_objectSpread({},b._todo),{},{name:d,notes:e})).then(function(a){b._todosController.update(a,"notes"),b._modal.hide()})}),a.addEventListener("reset",function(){b.setTodo(null)})}},{key:"setTodo",value:function(a){this._todo=a,a&&(this._formNode.querySelector("#titleInput").value=a.name,this._formNode.querySelector("#notesInput").value=a.notes)}}]),a}(),TodoCreator=function(){"use strict";function a(){_classCallCheck(this,a)}return _createClass(a,[{key:"_createLi",value:function(b){var a=document.createElement("li");return a.className="rounded py-2 px-4"+(b?" done":""),a}},{key:"_createLoader",value:function(){var a=document.createElement("div"),b=document.createElement("span");return a.className="spinner-border text-primary hidden",a.setAttribute("role","status"),b.className="visually-hidden",b.innerText="Loading...",a.append(b),a}},{key:"_createLabel",value:function(c,b){var a=document.createElement("label");return a.className="name me-1",a.setAttribute("for","status-".concat(c)),a.setAttribute("title",b),a.innerText=b,a}},{key:"_createControlsContainer",value:function(){var a=document.createElement("div");return a.className="controls",a}},{key:"_createDeleteBtn",value:function(){var a=document.createElement("button");return a.className="btn btn-sm btn-danger me-3",a.innerText="Delete",a}},{key:"_createStatusCheckbox",value:function(b,c){var a=document.createElement("input");return a.className="form-check-input",a.setAttribute("id","status-".concat(b)),a.setAttribute("name","status-".concat(b)),a.setAttribute("type","checkbox"),a.checked=c,a}},{key:"_createEditButton",value:function(){var a=document.createElement("button"),b=document.createElement("i");return a.className="edit-btn btn btn-sm btn-primary me-3",a.setAttribute("type","button"),a.setAttribute("data-bs-toggle","modal"),a.setAttribute("data-bs-target","#editModal"),b.className="bi bi-pencil",a.append(b),a}},{key:"createTodo",value:function(a){var b=a.id,f=a.name,c=(a.creationDate,a.status),d=this._createLi(c),g=this._createLabel(b,f),e=this._createControlsContainer(),h=this._createDeleteBtn(),i=this._createStatusCheckbox(b,c),j=this._createLoader(),k=this._createEditButton();return e.append(h,k,i),d.append(g,e,j),d}}]),a}(),TodoController=function(){"use strict";function a(b,c){var d=b.todoCreator;_classCallCheck(this,a),this._todoList=c,this._todoCreator=d,this.allTodos={}}return _createClass(a,[{key:"takeRawData",value:function(b){var a=_objectSpread({},b);return delete a.node,a}},{key:"startLoading",value:function(b){var a=this.takeById(b);a&&a.node.querySelector(".spinner-border").classList.remove("hidden")}},{key:"endLoading",value:function(b){var a=this.takeById(b);a&&a.node.querySelector(".spinner-border").classList.add("hidden")}},{key:"remove",value:function(a){try{this.takeById(a).node.remove(),delete this.allTodos[a]}catch(b){console.error("Todo with such id not found: ".concat(b))}}},{key:"_updateStatus",value:function(a,b){if(b.status===a.status)return!1;a.status=b.status,b.status?a.node.classList.add("done"):a.node.classList.remove("done")}},{key:"_updateNotes",value:function(a,b){this.takeById(a.id).notes=a.notes,this.takeById(a.id).name=a.name,b.querySelector(".name").innerText=a.name}},{key:"update",value:function(a,c){try{var b=this.takeById(a.id);switch(c){case"status":a.status!==b.status&&this._updateStatus(b,a);break;case"notes":this._updateNotes(a,b.node)}}catch(d){console.error("Todo with such id not found: ".concat(d))}}},{key:"takeById",value:function(a){return this.allTodos[a]}},{key:"create",value:function(a){var b=this._todoCreator.createTodo(a),c=new Todo(_objectSpread(_objectSpread({},a),{},{node:b}));return this._todoList.append(b),this.allTodos[a.id]=c,c}}]),a}(),TodoApiService=function(){"use strict";function a(b){_classCallCheck(this,a),this._API_URL=b,this.headers={Accept:"application/json","Content-Type":"application/json"}}return _createClass(a,[{key:"delete",value:function(a){return fetch("".concat(this._API_URL,"/").concat(a),{method:"DELETE",headers:this.headers}).catch(function(a){return console.error(a)})}},{key:"create",value:function(a){return fetch("".concat(this._API_URL),{method:"POST",headers:this.headers,body:JSON.stringify(a)}).catch(function(a){return console.error(a)}).then(function(a){return a.json()})}},{key:"update",value:function(a){return fetch("".concat(this._API_URL,"/").concat(a.id),{method:"PUT",headers:this.headers,body:JSON.stringify(a)}).catch(function(a){return console.error(a)}).then(function(a){return a.json()})}},{key:"getAll",value:function(){return fetch(this._API_URL,{headers:this.headers}).catch(function(a){return console.error(a)}).then(function(a){return a.json()})}}]),a}(),TodoHandler=function(){"use strict";function a(b){var c=b.todoController,d=b.todoApiService,e=b.editFromController;_classCallCheck(this,a),this._todoController=c,this._todoApiService=d,this._editFromController=e}return _createClass(a,[{key:"addListeners",value:function(a){var e=this,b=a.node.querySelector(".btn-danger"),c=a.node.querySelector(".form-check-input"),d=a.node.querySelector(".edit-btn");b.addEventListener("click",function(){e._delete(a.id)}),c.addEventListener("input",function(b){var c=e._todoController.takeRawData(a);e._updateStatus(_objectSpread(_objectSpread({},c),{},{status:b.target.checked}))}),d.addEventListener("click",function(){e._editFromController.setTodo(a)})}},{key:"_delete",value:function(a){var b=this;this._todoController.startLoading(a),this._todoApiService.delete(a).then(function(){b._todoController.remove(a),b._todoController.endLoading(a)})}},{key:"_updateStatus",value:function(a){var b=this;this._todoController.startLoading(a.id),this._todoApiService.update(a).then(function(a){b._todoController.update(a,"status"),b._todoController.endLoading(a.id)})}}]),a}();window.addEventListener("load",function(){var c=document.getElementById("todo-container"),d=c.querySelector("#todo-list"),i=c.querySelector(".main-loading"),e=document.querySelector("#editModalForm"),f=new TodoCreator,b=new TodoController({todoCreator:f},d),a=new TodoApiService(API_URL),g=new EditFormController({apiService:a,todosController:b},e,"editModal"),h=new TodoHandler({todoController:b,todoApiService:a,editFromController:g});new TodoInputController({todoController:b,todoApiService:a,todoHandler:h},document.querySelector("#add-todo-form")),a.getAll().then(function(a){a.forEach(function(a){var c=b.create(a);h.addListeners(c)}),i.style.display="none"})})
